<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Order Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #2ecc71;
            --text-color: #333;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --sidebar-bg: #2c3e50;
            --app-font-size: 16px;
            --table-padding: 15px;
        }
        
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
            font-size: var(--app-font-size);
        }

        /* Compact View */
        body.view-compact {
            --table-padding: 8px;
        }

        /* Layout & Navigation */
        .app-container {
            display: flex;
            width: 100%;
        }

        .sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            color: white;
            display: none; /* Hidden until logged in */
            flex-direction: column;
            padding: 20px;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            transition: width 0.3s;
            z-index: 1000;
        }

        .sidebar h2 {
            text-align: center;
            margin: 0;
            font-size: 20px;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #34495e;
        }

        .toggle-btn {
            background: transparent !important;
            width: auto !important;
            padding: 0 5px;
            font-size: 24px;
            color: white;
            border: none;
            cursor: pointer;
        }

        .nav-item {
            padding: 15px;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 5px;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item:hover, .nav-item.active {
            background-color: var(--primary-color);
        }

        /* Collapsed Sidebar Styles */
        .sidebar.collapsed {
            width: 70px;
        }
        .sidebar.collapsed .nav-text, 
        .sidebar.collapsed h2 { display: none; }
        .sidebar.collapsed .sidebar-header { justify-content: center; }

        .main-content {
            flex: 1;
            padding: 30px;
            margin-left: 0; /* Adjusted via JS when sidebar is visible */
            width: 100%;
            transition: margin-left 0.3s;
        }

        /* Views */
        .view-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .view-section.active {
            display: block;
        }

        .tracker-container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 800px;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
        }

        h2.section-title {
            color: var(--text-color);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            display: inline-block;
            padding-bottom: 5px;
        }

        /* Search Section */
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
            justify-content: center;
        }

        input[type="text"] {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            width: 100%;
            font-size: var(--app-font-size);
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        select, input[type="number"], input[type="date"], input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: var(--app-font-size);
            box-sizing: border-box;
        }

        button {
            padding: 12px 25px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: var(--app-font-size);
            font-weight: 600;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        .btn-block {
            width: 100%;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: var(--table-padding);
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        tr:hover {
            background-color: #f9f9f9;
        }

        /* Order Details Section */
        #order-details {
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .order-info h3 {
            margin: 0 0 5px 0;
        }

        .order-info p {
            margin: 0;
            color: #777;
        }

        /* Progress Steps */
        .progress-track {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 40px;
        }

        .progress-track::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: #eee;
            z-index: 0;
        }

        .step {
            position: relative;
            z-index: 1;
            text-align: center;
            width: 25%;
        }

        .step-circle {
            width: 34px;
            height: 34px;
            background-color: #fff;
            border: 4px solid #eee;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #999;
            transition: all 0.4s;
        }

        .step-label {
            font-size: 14px;
            color: #999;
            font-weight: 500;
        }

        /* Active/Completed States */
        .step.active .step-circle {
            border-color: var(--primary-color);
            background-color: var(--primary-color);
            color: white;
        }

        .step.completed .step-circle {
            border-color: var(--success-color);
            background-color: var(--success-color);
            color: white;
        }

        .step.active .step-label, 
        .step.completed .step-label {
            color: var(--text-color);
        }

        /* Progress Bar Fill */
        .progress-fill {
            position: absolute;
            top: 15px;
            left: 0;
            height: 4px;
            background-color: var(--success-color);
            z-index: 0;
            width: 0%;
            transition: width 0.4s ease;
        }

        /* Error Message */
        .error-msg {
            color: #e74c3c;
            text-align: center;
            margin-top: 20px;
            display: none;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        .status-1 { background-color: #95a5a6; } /* Placed */
        .status-2 { background-color: #f39c12; } /* Processing */
        .status-3 { background-color: #3498db; } /* Shipped */
        .status-4 { background-color: #2ecc71; } /* Delivered */

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Adjustments */
        @media (max-width: 600px) {
            .sidebar {
                width: 60px;
                padding: 20px 5px;
            }
            .sidebar h2, .nav-text {
                display: none;
            }
            .main-content {
                margin-left: 60px !important; /* Override JS inline style if needed */
            }
            .search-box {
                flex-direction: column;
            }
            input[type="text"] {
                width: 100%;
                box-sizing: border-box;
            }
            button {
                width: 100%;
            }
            .step-label {
                font-size: 12px;
            }
        }

        /* --- Themes --- */
        
        /* Black Theme */
        body.theme-black {
            --primary-color: #3498db;
            --text-color: #e0e0e0;
            --bg-color: #000000;
            --card-bg: #121212;
            --sidebar-bg: #1a252f;
        }

        /* Navy Blue Theme */
        body.theme-navy {
            --primary-color: #64ffda;
            --text-color: #ccd6f6;
            --bg-color: #0a192f;
            --card-bg: #112240;
            --sidebar-bg: #020c1b;
        }

        /* Cream Theme */
        body.theme-cream {
            --primary-color: #d4a373;
            --text-color: #5d4037;
            --bg-color: #fefae0;
            --card-bg: #faedcd;
            --sidebar-bg: #d4a373;
        }

        /* Pastel Theme */
        body.theme-pastel {
            --primary-color: #ffb7b2;
            --text-color: #636e72;
            --bg-color: #fff0f5;
            --card-bg: #ffffff;
            --sidebar-bg: #c7ceea;
        }

        /* Shared Dark Theme Styles (Black & Navy) */
        body.theme-black .stat-card, 
        body.theme-black .table-container,
        body.theme-navy .stat-card, 
        body.theme-navy .table-container {
            background: var(--card-bg);
            color: var(--text-color);
        }
        
        body.theme-black th,
        body.theme-navy th {
            background-color: var(--sidebar-bg);
            color: var(--text-color);
        }

        body.theme-black td, body.theme-black th, body.theme-black .order-header,
        body.theme-navy td, body.theme-navy th, body.theme-navy .order-header {
            border-color: rgba(255,255,255,0.1);
        }

        body.theme-black tr:hover,
        body.theme-navy tr:hover {
            background-color: rgba(255,255,255,0.05);
        }

        body.theme-black input, body.theme-black select,
        body.theme-navy input, body.theme-navy select {
            background-color: var(--card-bg);
            border-color: rgba(255,255,255,0.2);
            color: var(--text-color);
        }

        body.theme-black .progress-track::before,
        body.theme-navy .progress-track::before {
            background-color: rgba(255,255,255,0.2);
        }

        body.theme-black .step-circle,
        body.theme-navy .step-circle {
            background-color: var(--card-bg);
            border-color: rgba(255,255,255,0.2);
        }

        /* Settings Controls */
        .settings-btn-group button {
            margin-right: 10px;
            margin-bottom: 10px;
            width: auto;
        }

        /* Top Header & Profile Dropdown */
        .top-header {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
            position: relative;
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-trigger {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .profile-trigger:hover {
            background-color: rgba(0,0,0,0.05);
        }

        .profile-avatar {
            width: 32px;
            height: 32px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            background-size: cover;
            background-position: center;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--card-bg);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-radius: 8px;
            width: 160px;
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 100;
            margin-top: 10px;
            border: 1px solid #eee;
        }

        .dropdown-menu.show {
            display: flex;
        }

        .dropdown-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: background 0.2s;
            color: var(--text-color);
        }

        .dropdown-item:hover {
            background-color: var(--bg-color);
        }

        #rememberMe {
            accent-color: var(--primary-color);
        }

        body.theme-black .profile-trigger:hover, body.theme-navy .profile-trigger:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        body.theme-black .dropdown-menu, body.theme-navy .dropdown-menu {
            border-color: rgba(255,255,255,0.1);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }
        .pagination button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* Login Specific Styles */
        #login-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), var(--sidebar-bg));
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        /* Ensure it hides when not active */
        #login-view:not(.active) {
            display: none !important;
        }
        
        #login-view.active {
            display: flex !important;
        }

        #login-view .tracker-container {
            max-width: 400px;
            margin: 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            animation: slideUp 0.5s ease;
        }

        .subtitle {
            text-align: center;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }

        /* Floating Labels */
        .form-group.floating {
    position: relative;
            margin-bottom: 25px;
        }
        .form-group.floating input {
            height: 50px;
        }
        .form-group.floating label {
            position: absolute;
            top: 50%;
            left: 15px;
            transform: translateY(-50%);
            background-color: var(--card-bg);
            padding: 0 5px;
            color: #777;
            transition: 0.2s ease all;
            pointer-events: none;
            margin: 0;
            font-weight: normal;
        }
        .form-group.floating input:focus + label,
        .form-group.floating input:not(:placeholder-shown) + label {
            top: 0;
            font-size: 12px;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        /* Floating Labels */
        .form-group.floating {
    position: relative;
            margin-bottom: 25px;
        }
        .form-group.floating input {
            height: 50px;
        }
        .form-group.floating label {
            position: absolute;
            top: 50%;
            left: 15px;
            transform: translateY(-50%);
            background-color: var(--card-bg);
            padding: 0 5px;
            color: #777;
            transition: 0.2s ease all;
            pointer-events: none;
            margin: 0;
            font-weight: normal;
        }
        .form-group.floating input:focus + label,
        .form-group.floating input:not(:placeholder-shown) + label {
            top: 0;
            font-size: 12px;
            color: var(--primary-color);
            font-weight: 600;
        }

        /* Editable Table Cells */
        td[contenteditable] {
            cursor: text;
            transition: background 0.2s;
        }
        td[contenteditable]:focus {
            background-color: rgba(52, 152, 219, 0.1);
            outline: none;
            box-shadow: inset 0 0 0 2px var(--primary-color);
        }
        td[contenteditable]:empty::before {
            content: attr(data-placeholder);
            color: #ccc;
        }

        /* Drag & Drop */
        .draggable { cursor: grab; }
        .draggable:active { cursor: grabbing; }
        .drag-over { border: 2px dashed var(--primary-color); }
    </style>
</head>
<body>

<div class="app-container">
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>OrderSys</h2>
            <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>
        </div>
        <div class="nav-item active" onclick="showView('dashboard')">
            <span>üìä</span> <span class="nav-text">Dashboard</span>
        </div>
        <div class="nav-item" onclick="showView('create')">
            <span>‚ûï</span> <span class="nav-text">New Order</span>
        </div>
        <div class="nav-item" onclick="showView('list')">
            <span>üìã</span> <span class="nav-text">Order List</span>
        </div>
        <div class="nav-item" onclick="showView('tracker')">
            <span>üîç</span> <span class="nav-text">Tracker</span>
        </div>
        <div class="nav-item" onclick="showView('report')">
            <span>üìà</span> <span class="nav-text">Reports</span>
        </div>
        <div class="nav-item" style="margin-top: auto;" onclick="logout()">
            <span>üö™</span> <span class="nav-text">Logout</span> 
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">
        
        <!-- Top Header (Profile) -->
        <header id="topHeader" class="top-header" style="display: none;">
            <div class="profile-dropdown">
                <div class="profile-trigger" onclick="toggleProfileMenu(event)">
                    <div class="profile-avatar" id="headerAvatar">A</div>
                    <span class="profile-name" id="headerName">Admin</span>
                    <span>‚ñº</span>
                </div>
                <div class="dropdown-menu" id="profileMenu">
                    <div class="dropdown-item" onclick="showView('profile')">Profile</div>
                    <div class="dropdown-item" onclick="showView('settings')">Settings</div>
                    <div class="dropdown-item" onclick="logout()">Logout</div>
                </div>
            </div>
        </header>
        
        <!-- 1. Login View -->
        <section id="login-view" class="view-section active">
            <div class="tracker-container">
                <p class="subtitle">Enter your credentials to access the dashboard.</p>
                <div class="form-group floating">
                    <input type="text" id="username" placeholder=" ">
                    <label>Username</label>
                </div>
                <div class="form-group floating">
                    <input type="password" id="password" placeholder=" ">
                    <label>Password</label>
                </div>
                <div class="form-group" style="display: flex; align-items: center;">
                    <input type="checkbox" id="rememberMe" style="width: auto; margin-right: 10px;">
                    <label for="rememberMe" style="margin-bottom: 0; font-weight: normal;">Remember Me</label>
                </div>
                <button class="btn-block" id="loginBtn" onclick="login()">Login</button>
                <p id="loginError" class="error-msg">Invalid credentials</p>
            </div>
        </section>

        <!-- 2. Dashboard View -->
        <section id="dashboard-view" class="view-section">
            <h2 class="section-title">Dashboard</h2>
            <div class="dashboard-grid">
                <div class="stat-card">
                    <h3>Total Orders</h3>
                    <div class="stat-number" id="dash-total">0</div>
                </div>
                <div class="stat-card">
                    <h3>Pending</h3>
                    <div class="stat-number" id="dash-pending" style="color: #f39c12">0</div>
                </div>
                <div class="stat-card">
                    <h3>Delivered</h3>
                    <div class="stat-number" id="dash-delivered" style="color: #2ecc71">0</div>
                </div>
                <div class="stat-card">
                    <h3>Revenue</h3>
                    <div class="stat-number" id="dash-revenue">$0</div>
                </div>
            </div>
        </section>

        <!-- 3. Create Order View -->
        <section id="create-view" class="view-section">
            <div class="tracker-container">
                <h1>Create New Order</h1>
                <div class="form-group">
                    <label>Customer Name</label>
                    <input type="text" id="newCustomerName" placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Order Date</label>
                    <input type="date" id="newOrderDate">
                </div>
                <div class="form-group">
                    <label>Total Amount ($)</label>
                    <input type="number" id="newOrderTotal" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Number of Items</label>
                    <input type="number" id="newOrderItems" placeholder="1">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="newOrderStatus">
                        <option value="1">Placed</option>
                        <option value="2">Processing</option>
                        <option value="3">Shipped</option>
                        <option value="4">Delivered</option>
                    </select>
                </div>
                <button class="btn-block" onclick="createNewOrder()">Create Order</button>
            </div>
        </section>

        <!-- 4. Order List View -->
        <section id="list-view" class="view-section">
            <h2 class="section-title">Order List</h2>
            <div class="search-box" style="justify-content: space-between; margin-bottom: 20px;">
                <input type="text" id="listSearchInput" placeholder="Filter by ID or Customer Name..." onkeyup="filterOrders()" style="flex: 1; margin-right: 10px;">
                <button onclick="exportToCSV()" style="white-space: nowrap;">Export CSV</button>
            </div>
            <div class="table-container">
                <table id="ordersTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllOrders" onclick="toggleAllOrders(this)"></th>
                            <th>ID</th>
                            <th>Customer</th>
                            <th>Date</th>
                            <th>Total</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
            <div class="pagination">
                <button id="prevBtn" onclick="changePage(-1)">Previous</button>
                <span id="pageInfo">Page 1 of 1</span>
                <button id="nextBtn" onclick="changePage(1)">Next</button>
            </div>
        </section>

        <!-- 5. Report View -->
        <section id="report-view" class="view-section">
            <h2 class="section-title">Reports</h2>
            <div class="tracker-container" style="margin-bottom: 20px;">
                <h3>Order Status Breakdown</h3>
                <div id="report-content">
                    <!-- Simple text report -->
                </div>
            </div>
            
            <div class="tracker-container">
                <h3>Custom Chart Generator</h3>
                <div class="form-group">
                    <label>Chart Type</label>
                    <select id="chartTypeSelector" onchange="saveManualData()">
                        <option value="bar">Bar Chart</option>
                        <option value="pie">Pie Chart</option>
                        <option value="doughnut">Doughnut Chart</option>
                        <option value="line">Line Chart</option>
                    </select>
                </div>
                <div class="form-group" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <input type="checkbox" id="useSecondaryAxis" style="width: auto;" onchange="saveManualData(); renderManualChart()">
                    <label for="useSecondaryAxis" style="margin: 0; font-weight: normal;">Render last column as Secondary Line (Dual Axis)</label>
                </div>
                <div style="text-align: right; margin-bottom: 5px;">
                    <button onclick="transposeTable()" title="Swap rows and columns" style="padding: 5px 10px; font-size: 12px; width: auto; background-color: #7f8c8d; margin-right: 5px;">Transpose ‚áÖ</button>
                    <button onclick="addColumn()" style="padding: 5px 10px; font-size: 12px; width: auto; background-color: #34495e;">+ Add Column</button>
                </div>
                <table id="manualReportTable" style="margin-bottom: 15px;">
                    <thead>
                        <tr id="manualHeaderRow">
                            <th>Label</th>
                            <th style="width: 60px;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="manualReportBody"></tbody>
                </table>
                <button onclick="addManualRow()" style="margin-bottom: 15px; background-color: #95a5a6; width: auto;">+ Add Row</button>
                <div id="manualTotalsContainer" style="text-align: right; font-size: 1.2em; margin-bottom: 20px;">
                    <!-- Dynamic totals -->
                </div>
                <button class="btn-block" onclick="renderManualChart()">Generate Chart</button>
                <div style="margin-top: 30px;">
                    <canvas id="customChartCanvas"></canvas>
                </div>
            </div>
        </section>

        <!-- 7. Settings View -->
        <section id="settings-view" class="view-section">
            <h2 class="section-title">Settings</h2>
            <div class="tracker-container">
                <h3>Appearance</h3>
                <div class="form-group">
                    <label>Font Size</label>
                    <div class="settings-btn-group">
                        <button onclick="setFontSize('small')">Small</button>
                        <button onclick="setFontSize('medium')">Medium</button>
                        <button onclick="setFontSize('large')">Large</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>View Density</label>
                    <div class="settings-btn-group">
                        <button onclick="setDensity('comfortable')">Comfortable</button>
                        <button onclick="setDensity('compact')">Compact</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Theme Color</label>
                    <div class="settings-btn-group">
                        <button onclick="applyTheme('light')">Light</button>
                        <button onclick="applyTheme('black')">Black</button>
                        <button onclick="applyTheme('navy')">Navy</button>
                        <button onclick="applyTheme('cream')">Cream</button>
                        <button onclick="applyTheme('pastel')">Pastel</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 8. Profile View -->
        <section id="profile-view" class="view-section">
            <h2 class="section-title">My Profile</h2>
            <div class="tracker-container">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div id="profilePreview" class="profile-avatar" style="width: 80px; height: 80px; font-size: 32px; margin: 0 auto; background-color: var(--primary-color);">A</div>
                </div>
                <div class="form-group">
                    <label>Profile Image</label>
                    <input type="file" id="avatarUpload" accept="image/*" onchange="handleImageUpload(this)">
                    <button onclick="removeAvatarImage()" style="margin-top: 5px; background-color: #e74c3c; padding: 8px; width: auto; font-size: 12px;">Remove Image</button>
                </div>
                <div class="form-group">
                    <label>Avatar Color</label>
                    <input type="color" id="editColor" style="height: 50px; padding: 5px; cursor: pointer;" onchange="updatePreview()">
                </div>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="editUsername">
                </div>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="editPassword" placeholder="Leave blank to keep current">
                </div>
                <button class="btn-block" onclick="saveProfile()">Save Changes</button>
            </div>
        </section>

        <!-- 6. Tracker View (Original) -->
        <section id="tracker-view" class="view-section">
            <div class="tracker-container">
                <h1>Track Your Order</h1>
                
                <div class="search-box">
                    <input type="text" id="orderInput" placeholder="Enter Order ID (e.g., 1001)">
                    <button onclick="trackOrder()">Track Order</button>
                </div>

                <p id="errorMsg" class="error-msg">Order not found. Please check your ID.</p>

                <div id="order-details">
                    <div class="order-header">
                        <div class="order-info">
                            <h3>Order <span id="displayId">#</span></h3>
                            <p>Date: <span id="displayDate"></span></p>
                        </div>
                        <div class="order-info" style="text-align: right;">
                            <h3>Total: <span id="displayTotal"></span></h3>
                            <p id="displayItems">Items: 0</p>
                        </div>
                    </div>

                    <div class="progress-track">
                        <div class="progress-fill" id="progressFill"></div>
                        <div class="step" id="step1">
                            <div class="step-circle">1</div>
                            <div class="step-label">Placed</div>
                        </div>
                        <div class="step" id="step2">
                            <div class="step-circle">2</div>
                            <div class="step-label">Processing</div>
                        </div>
                        <div class="step" id="step3">
                            <div class="step-circle">3</div>
                            <div class="step-label">Shipped</div>
                        </div>
                        <div class="step" id="step4">
                            <div class="step-circle">4</div>
                            <div class="step-label">Delivered</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
</div>

<script>
    // Mock Database
    let orders = {
        '1001': { id: '1001', customer: 'Alice Smith', status: 4, date: '2023-10-28', total: 120.50, items: 3 },
        '1002': { id: '1002', customer: 'Bob Jones', status: 3, date: '2023-11-02', total: 45.00, items: 1 },
        '1003': { id: '1003', customer: 'Charlie Day', status: 2, date: '2023-11-05', total: 210.99, items: 5 },
        '1004': { id: '1004', customer: 'Dana White', status: 1, date: '2023-11-10', total: 15.00, items: 1 }
    };
    let currentPage = 1;
    const itemsPerPage = 5;

    // User Data Management
    const defaultUser = { username: 'admin', password: 'admin', color: '#3498db' };
    
    function getUserData() {
        return JSON.parse(localStorage.getItem('userProfile')) || defaultUser;
    }

    // --- Navigation & Auth ---

    function login() {
        const user = document.getElementById('username').value;
        const pass = document.getElementById('password').value;
        const btn = document.getElementById('loginBtn');
        const errorMsg = document.getElementById('loginError');
        const storedUser = getUserData();
        const remember = document.getElementById('rememberMe').checked;
        
        // UI Loading State
        errorMsg.style.display = 'none';
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner"></span> Logging in...';

        setTimeout(() => {
            if (user === storedUser.username && pass === storedUser.password) {
                if (remember) {
                    localStorage.setItem('isLoggedIn', 'true');
                } else {
                    sessionStorage.setItem('isLoggedIn', 'true');
                }
                document.getElementById('sidebar').style.display = 'flex';
                document.getElementById('mainContent').style.marginLeft = '250px';
                document.getElementById('topHeader').style.display = 'flex';
                updateHeaderProfile();
                showView('dashboard');
            } else {
                errorMsg.style.display = 'block';
            }
            // Reset button
            btn.disabled = false;
            btn.innerText = 'Login';
        }, 1000);
    }

    function logout() {
        localStorage.removeItem('isLoggedIn');
        sessionStorage.removeItem('isLoggedIn');
        localStorage.removeItem('currentView');
        document.getElementById('sidebar').style.display = 'none';
        document.getElementById('mainContent').style.marginLeft = '0';
        document.getElementById('topHeader').style.display = 'none';
        showView('login');
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
    }

    function updateHeaderProfile() {
        const user = getUserData();
        const avatar = document.getElementById('headerAvatar');
        const name = document.getElementById('headerName');

        name.innerText = user.username;
        
        if (user.avatarImage) {
            avatar.style.backgroundImage = `url(${user.avatarImage})`;
            avatar.innerText = '';
            avatar.style.backgroundColor = 'transparent';
        } else {
            avatar.style.backgroundImage = 'none';
            avatar.innerText = user.username.charAt(0).toUpperCase();
            avatar.style.backgroundColor = user.color;
        }
    }

    function updatePreview() {
        const color = document.getElementById('editColor').value;
        const preview = document.getElementById('profilePreview');
        preview.style.backgroundColor = color;
        
        // Only show text if no image is set
        const hasImage = preview.style.backgroundImage && preview.style.backgroundImage !== 'none';
        
        if (!hasImage) {
             const username = document.getElementById('editUsername').value || 'A';
             preview.innerText = username.charAt(0).toUpperCase();
        } else {
             preview.innerText = '';
        }
    }

    function handleImageUpload(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('profilePreview');
                preview.style.backgroundImage = `url(${e.target.result})`;
                preview.innerText = '';
                preview.dataset.tempImage = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function removeAvatarImage() {
        const preview = document.getElementById('profilePreview');
        document.getElementById('avatarUpload').value = '';
        preview.style.backgroundImage = 'none';
        preview.dataset.tempImage = ''; // Mark as removed
        updatePreview(); // Restore text/color
    }

    function saveProfile() {
        const username = document.getElementById('editUsername').value;
        const password = document.getElementById('editPassword').value;
        const color = document.getElementById('editColor').value;
        const preview = document.getElementById('profilePreview');
        
        if(!username) return alert("Username cannot be empty");
        
        const currentUser = getUserData();
        
        // Determine image: if dataset.tempImage is set (string or empty), use it. 
        // If undefined (user didn't touch), keep current.
        let finalImage = currentUser.avatarImage;
        if (preview.dataset.tempImage !== undefined) {
            finalImage = preview.dataset.tempImage;
        }

        const newUser = {
            username: username,
            password: password ? password : currentUser.password,
            color: color,
            avatarImage: finalImage
        };
        
        localStorage.setItem('userProfile', JSON.stringify(newUser));
        updateHeaderProfile();
        
        // Update preview text just in case image was removed
        if (!finalImage) {
            preview.innerText = username.charAt(0).toUpperCase();
        }
        
        alert("Profile updated successfully!");
    }

    function showView(viewName) {
        // Hide all views
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        // Show selected
        document.getElementById(viewName + '-view').classList.add('active');
        
        // Update Sidebar Active State
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        // Find the nav item that calls this view (simple matching)
        const navItems = document.querySelectorAll('.nav-item');
        if(viewName === 'dashboard') navItems[0].classList.add('active');
        if(viewName === 'create') navItems[1].classList.add('active');
        if(viewName === 'list') navItems[2].classList.add('active');
        if(viewName === 'tracker') navItems[3].classList.add('active');
        if(viewName === 'report') navItems[4].classList.add('active');
        
        // Populate Profile View if selected
        if (viewName === 'profile') {
            const user = getUserData();
            document.getElementById('editUsername').value = user.username;
            document.getElementById('editColor').value = user.color;
            
            const preview = document.getElementById('profilePreview');
            preview.style.backgroundColor = user.color;
            
            // Reset temp state
            delete preview.dataset.tempImage;

            if (user.avatarImage) {
                preview.style.backgroundImage = `url(${user.avatarImage})`;
                preview.innerText = '';
            } else {
                preview.style.backgroundImage = 'none';
                preview.innerText = user.username.charAt(0).toUpperCase();
            }
        }

        // Refresh data if needed
        if (viewName === 'dashboard') updateDashboard();
        if (viewName === 'list') {
            if(document.getElementById('listSearchInput')) document.getElementById('listSearchInput').value = '';
            currentPage = 1;
            renderOrderList();
        }
        if (viewName === 'report') {
            generateReport();
            if(document.getElementById('manualReportBody').children.length === 0) loadManualData();
        }

        // Persist View
        if (viewName !== 'login') {
            localStorage.setItem('currentView', viewName);
        }
    }

    // --- Dashboard Logic ---
    function updateDashboard() {
        const orderList = Object.values(orders);
        document.getElementById('dash-total').innerText = orderList.length;
        document.getElementById('dash-pending').innerText = orderList.filter(o => o.status < 4).length;
        document.getElementById('dash-delivered').innerText = orderList.filter(o => o.status === 4).length;
        
        const revenue = orderList.reduce((acc, curr) => acc + curr.total, 0);
        document.getElementById('dash-revenue').innerText = '$' + revenue.toFixed(2);
    }

    // --- Create Order Logic ---
    function createNewOrder() {
        const id = '100' + (Object.keys(orders).length + 1);
        const customer = document.getElementById('newCustomerName').value;
        const date = document.getElementById('newOrderDate').value || new Date().toISOString().split('T')[0];
        const total = parseFloat(document.getElementById('newOrderTotal').value) || 0;
        const items = parseInt(document.getElementById('newOrderItems').value) || 1;
        const status = parseInt(document.getElementById('newOrderStatus').value);

        if (!customer) { alert('Customer Name is required'); return; }

        orders[id] = { id, customer, date, total, items, status };
        
        alert('Order Created! ID: ' + id);
        // Reset form
        document.getElementById('newCustomerName').value = '';
        document.getElementById('newOrderTotal').value = '';
        showView('list');
    }

    // --- List Logic ---
    function renderOrderList() {
        const tbody = document.querySelector('#ordersTable tbody');
        tbody.innerHTML = '';
        
        // Reset select all checkbox
        if(document.getElementById('selectAllOrders')) document.getElementById('selectAllOrders').checked = false;
        
        const query = document.getElementById('listSearchInput') ? document.getElementById('listSearchInput').value.toLowerCase() : '';
        const statusLabels = { 1: 'Placed', 2: 'Processing', 3: 'Shipped', 4: 'Delivered' };

        let allOrders = Object.values(orders);
        
        // Filter
        let filteredOrders = allOrders.filter(order => {
            const id = order.id.toLowerCase();
            const customer = order.customer.toLowerCase();
            return id.includes(query) || customer.includes(query);
        });

        // Paginate
        const totalPages = Math.ceil(filteredOrders.length / itemsPerPage) || 1;
        
        if (currentPage > totalPages) currentPage = totalPages;
        if (currentPage < 1) currentPage = 1;

        const paginatedOrders = filteredOrders.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);

        paginatedOrders.forEach(order => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="checkbox" class="order-checkbox" value="${order.id}"></td>
                <td>#${order.id}</td>
                <td>${order.customer}</td>
                <td>${order.date}</td>
                <td>$${order.total.toFixed(2)}</td>
                <td><span class="status-badge status-${order.status}">${statusLabels[order.status]}</span></td>
            `;
            tbody.appendChild(tr);
        });

        // Update Pagination Controls
        document.getElementById('pageInfo').innerText = `Page ${currentPage} of ${totalPages}`;
        document.getElementById('prevBtn').disabled = currentPage === 1;
        document.getElementById('nextBtn').disabled = currentPage >= totalPages;
    }

    function toggleAllOrders(source) {
        const checkboxes = document.querySelectorAll('.order-checkbox');
        checkboxes.forEach(cb => cb.checked = source.checked);
    }

    function changePage(direction) {
        currentPage += direction;
        renderOrderList();
    }

    // --- Report Logic ---
    function generateReport() {
        const orderList = Object.values(orders);
        const counts = { 1: 0, 2: 0, 3: 0, 4: 0 };
        orderList.forEach(o => counts[o.status]++);

        const html = `
            <p><strong>Placed:</strong> ${counts[1]}</p>
            <p><strong>Processing:</strong> ${counts[2]}</p>
            <p><strong>Shipped:</strong> ${counts[3]}</p>
            <p><strong>Delivered:</strong> ${counts[4]}</p>
            <hr>
            <p><strong>Total Orders:</strong> ${orderList.length}</p>
        `;
        document.getElementById('report-content').innerHTML = html;
    }

    // --- Manual Chart Logic ---
    let customChartInstance = null;
    let manualChartState = {
        headers: ['Value 1', 'Value 2'],
        rows: []
    };

    function loadManualData() {
        const saved = localStorage.getItem('manualChartDataV2');
        if (saved) {
            manualChartState = JSON.parse(saved);
        } else {
            // Migration from V1
            const v1Data = JSON.parse(localStorage.getItem('manualChartData'));
            if (v1Data && v1Data.length) {
                manualChartState.rows = v1Data.map(r => ({
                    label: r.label,
                    values: [r.val1, r.val2]
                }));
            } else {
                // Default init
                if (manualChartState.rows.length === 0) {
                    manualChartState.rows.push({ label: '', values: ['', ''] });
                }
            }
        }
        
        const savedType = localStorage.getItem('manualChartType');
        if (savedType) document.getElementById('chartTypeSelector').value = savedType;

        const savedSecondary = localStorage.getItem('manualChartSecondary') === 'true';
        if (document.getElementById('useSecondaryAxis')) document.getElementById('useSecondaryAxis').checked = savedSecondary;

        renderManualTable();
    }

    function renderManualTable() {
        // 1. Headers
        const headerRow = document.getElementById('manualHeaderRow');
        // Remove existing dynamic headers (keep first and last)
        while (headerRow.children.length > 2) {
            headerRow.removeChild(headerRow.children[1]);
        }
        
        const actionTh = headerRow.lastElementChild;
        manualChartState.headers.forEach((h, i) => {
            const th = document.createElement('th');
            // Drag attributes
            th.draggable = true;
            th.classList.add('draggable');
            th.ondragstart = (e) => handleDragStart(e, 'col', i);
            th.ondragover = handleDragOver;
            th.ondragenter = handleDragEnter;
            th.ondragleave = handleDragLeave;
            th.ondrop = (e) => handleDrop(e, 'col', i);
            th.ondragend = handleDragEnd;

            th.innerHTML = `
                <span contenteditable="true" onblur="updateHeaderName(${i}, this.innerText)">${h}</span>
                <span onclick="deleteColumn(${i})" style="cursor:pointer; color:#e74c3c; margin-left:5px; font-size:14px; font-weight:bold;">&times;</span>
            `;
            headerRow.insertBefore(th, actionTh);
        });

        // 2. Body
        const tbody = document.getElementById('manualReportBody');
        tbody.innerHTML = '';
        
        manualChartState.rows.forEach((row, rIndex) => {
            const tr = document.createElement('tr');
            // Drag attributes
            tr.draggable = true;
            tr.classList.add('draggable');
            tr.ondragstart = (e) => handleDragStart(e, 'row', rIndex);
            tr.ondragover = handleDragOver;
            tr.ondragenter = handleDragEnter;
            tr.ondragleave = handleDragLeave;
            tr.ondrop = (e) => handleDrop(e, 'row', rIndex);
            tr.ondragend = handleDragEnd;

            let html = `<td contenteditable="true" class="chart-label" data-placeholder="Item Name" oninput="updateRowLabel(${rIndex}, this.innerText)">${row.label}</td>`;
            
            // Sync values length
            while(row.values.length < manualChartState.headers.length) row.values.push('');
            
            row.values.forEach((val, cIndex) => {
                html += `<td contenteditable="true" class="chart-value" data-placeholder="0" oninput="updateRowValue(${rIndex}, ${cIndex}, this.innerText)">${val}</td>`;
            });
            
            html += `<td><button onclick="removeManualRow(${rIndex})" style="background-color: #e74c3c; padding: 8px;">X</button></td>`;
            tr.innerHTML = html;
            tbody.appendChild(tr);
        });

        calculateManualTotal();
    }

    function addColumn() {
        manualChartState.headers.push(`Value ${manualChartState.headers.length + 1}`);
        manualChartState.rows.forEach(r => r.values.push(''));
        saveAndRender();
    }

    function deleteColumn(index) {
        if (manualChartState.headers.length <= 1) {
            alert("Cannot delete the last value column.");
            return;
        }
        if (confirm("Delete this column?")) {
            manualChartState.headers.splice(index, 1);
            manualChartState.rows.forEach(r => r.values.splice(index, 1));
            saveAndRender();
        }
    }

    function transposeTable() {
        if (manualChartState.rows.length === 0 && manualChartState.headers.length === 0) {
            alert("Cannot transpose an empty table.");
            return;
        }

        // New headers are the old row labels. Provide a default if a label is empty.
        const newHeaders = manualChartState.rows.map((r, i) => r.label || `Item ${i + 1}`);

        // New rows are created from old headers.
        const newRows = manualChartState.headers.map((oldHeader, colIndex) => {
            return {
                label: oldHeader,
                // The values for this new row are all the values from the old column `colIndex`.
                values: manualChartState.rows.map(oldRow => oldRow.values[colIndex] || '')
            };
        });

        manualChartState.headers = newHeaders;
        manualChartState.rows = newRows;

        saveAndRender();
    }

    // --- Drag & Drop Logic ---
    let dragSrcIndex = null;
    let dragType = null;

    function handleDragStart(e, type, index) {
        dragSrcIndex = index;
        dragType = type;
        e.target.style.opacity = '0.4';
        e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragOver(e) {
        if (e.preventDefault) e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        return false;
    }

    function handleDragEnter(e) {
        const target = e.target.closest(dragType === 'row' ? 'tr' : 'th');
        if(target) target.classList.add('drag-over');
    }

    function handleDragLeave(e) {
        const target = e.target.closest(dragType === 'row' ? 'tr' : 'th');
        if(target) target.classList.remove('drag-over');
    }

    function handleDragEnd(e) {
        e.target.style.opacity = '1';
        document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
    }

    function handleDrop(e, type, targetIndex) {
        if (e.stopPropagation) e.stopPropagation();
        
        if (dragType !== type || dragSrcIndex === targetIndex) return false;

        if (type === 'row') {
            const movedRow = manualChartState.rows.splice(dragSrcIndex, 1)[0];
            manualChartState.rows.splice(targetIndex, 0, movedRow);
        } else if (type === 'col') {
            const movedHeader = manualChartState.headers.splice(dragSrcIndex, 1)[0];
            manualChartState.headers.splice(targetIndex, 0, movedHeader);
            
            manualChartState.rows.forEach(row => {
                const movedVal = row.values.splice(dragSrcIndex, 1)[0];
                row.values.splice(targetIndex, 0, movedVal);
            });
        }

        saveAndRender();
        return false;
    }

    function addManualRow() {
        const emptyVals = new Array(manualChartState.headers.length).fill('');
        manualChartState.rows.push({ label: '', values: emptyVals });
        saveAndRender();
    }

    function removeManualRow(index) {
        manualChartState.rows.splice(index, 1);
        saveAndRender();
    }

    function updateHeaderName(index, name) {
        manualChartState.headers[index] = name;
        saveManualData();
    }

    function updateRowLabel(index, val) {
        manualChartState.rows[index].label = val;
        saveManualData();
    }

    function updateRowValue(rIndex, cIndex, val) {
        manualChartState.rows[rIndex].values[cIndex] = val;
        calculateManualTotal();
        saveManualData();
    }

    function saveAndRender() {
        saveManualData();
        renderManualTable();
    }

    function saveManualData() {
        localStorage.setItem('manualChartDataV2', JSON.stringify(manualChartState));
        localStorage.setItem('manualChartType', document.getElementById('chartTypeSelector').value);
        if (document.getElementById('useSecondaryAxis')) localStorage.setItem('manualChartSecondary', document.getElementById('useSecondaryAxis').checked);
    }

    function calculateManualTotal() {
        const container = document.getElementById('manualTotalsContainer');
        const totals = manualChartState.headers.map(() => 0);
        
        manualChartState.rows.forEach(row => {
            row.values.forEach((val, i) => {
                totals[i] += parseFloat(val) || 0;
            });
        });

        container.innerHTML = totals.map((t, i) => {
            const color = `hsl(${i * 137.5 % 360}, 70%, 40%)`;
            return `<span style="color:${color}; font-weight:bold;">${manualChartState.headers[i]}: ${t.toFixed(2)}</span>`;
        }).join(' | ');
    }

    function renderManualChart() {
        const ctx = document.getElementById('customChartCanvas').getContext('2d');
        const type = document.getElementById('chartTypeSelector').value;
        const useSecondary = document.getElementById('useSecondaryAxis') ? document.getElementById('useSecondaryAxis').checked : false;
        
        const labels = manualChartState.rows.map(r => r.label).filter(l => l);
        const validRows = manualChartState.rows.filter(r => r.label);
        
        const datasets = manualChartState.headers.map((header, i) => {
            const data = validRows.map(r => parseFloat(r.values[i]) || 0);
            const baseColor = i * 137.5 % 360;
            
            // Check if this is the secondary dataset (last column, if enabled)
            const isSecondary = useSecondary && i === manualChartState.headers.length - 1 && manualChartState.headers.length > 1;
            // Check if label explicitly requests line (e.g. "Target (Line)")
            const isExplicitLine = header.toLowerCase().includes('(line)');

            const color = `hsl(${baseColor}, 70%, 60%)`;
            const bgColors = type === 'pie' || type === 'doughnut' 
                ? validRows.map((_, ri) => `hsl(${baseColor + (ri * 30)}, 70%, 60%)`) 
                : (type === 'line' ? `hsla(${baseColor}, 70%, 60%, 0.2)` : color);
            
            const dataset = {
                label: header,
                data: data,
                backgroundColor: bgColors,
                borderColor: `hsl(${baseColor}, 70%, 50%)`,
                borderWidth: 1,
                fill: type === 'line'
            };

            if ((isSecondary || isExplicitLine) && type !== 'pie' && type !== 'doughnut') {
                dataset.type = 'line';
                dataset.yAxisID = isSecondary ? 'y1' : 'y';
                if (isSecondary) dataset.borderColor = '#e74c3c'; // Distinct color for secondary axis
                dataset.backgroundColor = 'transparent';
                dataset.borderWidth = 2;
            } else {
                dataset.yAxisID = 'y';
            }

            return dataset;
        });

        if (customChartInstance) customChartInstance.destroy();

        const options = {
            responsive: true,
            scales: {
                y: { beginAtZero: true, display: type !== 'pie' && type !== 'doughnut' }
            }
        };

        if (useSecondary && manualChartState.headers.length > 1 && type !== 'pie' && type !== 'doughnut') {
            options.scales.y1 = {
                type: 'linear',
                display: true,
                position: 'right',
                grid: {
                    drawOnChartArea: false
                }
            };
        }

        customChartInstance = new Chart(ctx, {
            type: type,
            data: {
                labels: labels,
                datasets: datasets
            },
            options: options
        });
    }

    // --- Tracker Logic (Original) ---
    function trackOrder() {
        const input = document.getElementById('orderInput').value.trim();
        const detailsDiv = document.getElementById('order-details');
        const errorMsg = document.getElementById('errorMsg');
        
        // Reset UI
        detailsDiv.style.display = 'none';
        errorMsg.style.display = 'none';

        if (orders[input]) {
            const order = orders[input];
            
            // Populate Data
            document.getElementById('displayId').innerText = '#' + input;
            document.getElementById('displayDate').innerText = order.date;
            document.getElementById('displayTotal').innerText = '$' + order.total.toFixed(2);
            document.getElementById('displayItems').innerText = order.items + (order.items > 1 ? ' Items' : ' Item');

            // Update Progress Bar
            updateProgress(order.status);

            // Show Details
            detailsDiv.style.display = 'block';
        } else {
            errorMsg.style.display = 'block';
        }
    }

    function updateProgress(statusLevel) {
        // Reset all steps
        for (let i = 1; i <= 4; i++) {
            const step = document.getElementById('step' + i);
            step.classList.remove('active', 'completed');
            step.querySelector('.step-circle').innerHTML = i;
        }

        // Calculate width for the progress line (3 gaps between 4 steps = 33.3% per gap)
        // Level 1: 0%, Level 2: 33%, Level 3: 66%, Level 4: 100%
        const widthPercentage = (statusLevel - 1) * 33.33;
        document.getElementById('progressFill').style.width = widthPercentage + '%';

        // Apply classes
        for (let i = 1; i <= 4; i++) {
            const step = document.getElementById('step' + i);
            if (i < statusLevel) {
                step.classList.add('completed');
                step.querySelector('.step-circle').innerHTML = '&#10003;'; // Checkmark
            } else if (i === statusLevel) {
                step.classList.add('active');
            }
        }
    }

    // --- Theme Logic ---
    function applyTheme(themeName) {
        // Remove all theme classes
        document.body.classList.remove('theme-black', 'theme-navy', 'theme-cream', 'theme-pastel');
        
        if (themeName !== 'light') {
            document.body.classList.add('theme-' + themeName);
        }
        // Save
        localStorage.setItem('appTheme', themeName);
    }

    // --- Settings Logic ---
    function setFontSize(size) {
        let px = '16px';
        if(size === 'small') px = '14px';
        if(size === 'large') px = '18px';
        document.documentElement.style.setProperty('--app-font-size', px);
        localStorage.setItem('fontSize', size);
    }

    function setDensity(density) {
        if(density === 'compact') document.body.classList.add('view-compact');
        else document.body.classList.remove('view-compact');
        localStorage.setItem('viewDensity', density);
    }

    // Initialize Settings
    (function() {
        const savedFontSize = localStorage.getItem('fontSize') || 'medium';
        const savedDensity = localStorage.getItem('viewDensity') || 'comfortable';
        setFontSize(savedFontSize);
        setDensity(savedDensity);
    })();

    // Initialize Theme from LocalStorage
    (function() {
        const savedTheme = localStorage.getItem('appTheme') || 'light';
        applyTheme(savedTheme);
    })();

    // Initialize Session (Persist Page)
    (function() {
        const loggedIn = localStorage.getItem('isLoggedIn') === 'true' || sessionStorage.getItem('isLoggedIn') === 'true';
        if (loggedIn) {
            document.getElementById('sidebar').style.display = 'flex';
            document.getElementById('mainContent').style.marginLeft = '250px';
            document.getElementById('topHeader').style.display = 'flex';
            updateHeaderProfile();
            
            const savedView = localStorage.getItem('currentView') || 'dashboard';
            showView(savedView);
        }
    })();

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        sidebar.classList.toggle('collapsed');
        
        // Adjust margin based on state
        const isCollapsed = sidebar.classList.contains('collapsed');
        mainContent.style.marginLeft = isCollapsed ? '70px' : '250px';
    }

    function toggleProfileMenu(e) {
        if(e) e.stopPropagation();
        document.getElementById('profileMenu').classList.toggle('show');
    }

    // Close dropdown when clicking outside
    window.onclick = function(event) {
        if (!event.target.closest('.profile-trigger')) {
            const dropdowns = document.getElementsByClassName("dropdown-menu");
            for (let i = 0; i < dropdowns.length; i++) {
                dropdowns[i].classList.remove('show');
            }
        }
    }

    function filterOrders() {
        currentPage = 1;
        renderOrderList();
    }

    function exportToCSV() {
        const orderList = Object.values(orders);
        if (orderList.length === 0) {
            alert("No orders to export.");
            return;
        }

        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "ID,Customer Name,Date,Total,Items,Status\n";

        const statusLabels = { 1: 'Placed', 2: 'Processing', 3: 'Shipped', 4: 'Delivered' };

        orderList.forEach(order => {
            const row = [
                order.id,
                `"${order.customer}"`,
                order.date,
                order.total.toFixed(2),
                order.items,
                statusLabels[order.status]
            ].join(",");
            csvContent += row + "\n";
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "orders_export.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>

</body>
</html>
